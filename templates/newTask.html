  {% extends "layout.html" %}

  {% block main %}
        <form action="{{ action }}" method="POST" id="form" enctype="multipart/form-data">
                <div class="form-group">
                        <input type="text" name="title" class="form-control" placeholder="title" value="{{title}}">
                </div>
                <div class="form-group">
                        <textarea name="description" class="form-control" placeholder="Description">{{ desc }}</textarea>
                </div>
                <div class="form-group">
                        <input type="file" name="image">
                </div>
                <div class="form-group">
                        <label for="severity">Severity</label>
                        <select class="form-control" id="severity" name="severity">
                                {% if severity == "1" %}
                                <option value="1" checked>1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                {% elif severity == "2" %}
                                <option value="1">1</option>
                                <option value="2" checked>2</option>
                                <option value="3">3</option>
                                {% elif severity == "3" %}
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3" checked>3</option>
                                {% else %}
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                {% endif %}
                         </select>
                </div>
                <!-- <div class="form-group">
                        <div id="editor" class="form-control">{{content}}</div>
                </div> -->
                <div class="editor"  style="height: 85vh; overflow-y: auto;">
                        {{ content|safe }}
                </div>
                <!-- <button type="button" class="btn btn-primary" onclick="submitForm();">Submit Task</button> -->
                <input type="button" value="Submit Task" id="button" style="margin-top: 3vh">
        </form>
        <script src="../static/ckeditor.js"></script>
        <link rel="stylesheet" href="/static/ckeditor.css">
    <script>
            ClassicEditor
            .create( document.querySelector( '.editor' ), {
            toolbar: {
                items: [
                    'heading',
                    '|',
                    'bold',
                    'italic',
                    'link',
                    'bulletedList',
                    'numberedList',
                    '|',
                    'indent',
                    'outdent',
                    '|',
                    'imageUpload',
                    'blockQuote',
                    'insertTable',
                    'undo',
                    'redo'
                ]
            },
            language: 'en',
            image: {
                toolbar: [
                    'imageTextAlternative',
                    'imageStyle:full',
                    'imageStyle:side'
                ]
            },
            table: {
                contentToolbar: [
                    'tableColumn',
                    'tableRow',
                    'mergeTableCells'
                ]
            },
            licenseKey: '',
        } )
        .then( editor => {
            window.editor = editor;
        } )
        .catch( error => {
            console.error( error );
        } );
/*              function submitForm() {
                var form = document.getElementById("form");
                var input = document.createElement("input");
                input.setAttribute("name", "content");
                input.setAttribute("type", "hidden");
                input.setAttribute("value", window.editor.getData());
                form.appendChild(input);
                form.submit();
             } */
             document.querySelector("#button").onclick = () => {
            var form = document.getElementById("form");
            var input = document.createElement("INPUT");
            input.setAttribute("name", "content")
            input.setAttribute("type", "hidden")
            input.setAttribute("value", window.editor.getData())
            form.appendChild(input)
            form.submit();
        }
    </script>
{% endblock %}
